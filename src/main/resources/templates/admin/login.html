<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<base href="/mall">
<head th:include="admin/header::general-libraries-and-styles">
    <title></title>
    <!-- ??? -->
</head>

<link rel="stylesheet" th:href="@{/styles/admin/login.css}">
<body class="hold-transition login-page">
<div class="background">
    <div class="login-panel">
        <div class="login-panel-content">
            <div class="login-panel-header">
                <div class="language-option">
                    <div class="dropdown-list">
                        <div class="navbar-option-text">
                            <span th:text="#{user_language}"></span>
                            <span>
                            <i class="fa-solid fa-earth-europe"></i>
                        </span>
                        </div>
                        <div class="dropdown-content">
                            <div class="dropdown-option" onclick="location.href='mall/admin/login?lang=zh_CN'">
                                <span><img th:src="@{/assets/img/1f1e8-1f1f3.png}" alt="chinese" class="user-language-flag"></span>
                                <span>简体中文</span>
                            </div>
                            <div class="dropdown-option" onclick="location.href='mall/admin/login?lang=es_ES'">
                                <span><img th:src="@{/assets/img/1f1ea-1f1f8.png}" alt="spanish" class="user-language-flag" src=""></span>
                                <span>español</span>
                            </div>
                            <div class="dropdown-option" onclick="location.href='mall/admin/login?lang=en_US'">
                                <span><img th:src="@{/assets/img/1f1fa-1f1f8.png}" alt="english" class="user-language-flag"></span>
                                <span>english</span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="text-center">
                    <img th:src="@{/assets/img/poi_128x128.png}" alt="mall icon">
                </div>
            </div>
            <div class="login-panel-body">
                <div class="alert alert-danger login-alert text-center" role="alert"></div>
                <label for="input-username"></label>
                <input class="form-control" type="text" id="input-username" th:placeholder="#{username}">
                <label for="input-password"></label>
                <input class="form-control" type="password" id="input-password" th:placeholder="#{password}">
            </div>
            <div class="login-panel-footer">
                <div class="button-login no-text-select">
                    <span th:text="#{login}"></span>
                </div>
            </div>
        </div>
    </div>
</div>
</body>

<script th:inline="javascript">
    $("#input-password").keyup(function (e) {
        if (e.keyCode === 13) {
            $(".button-login").click();// call to log in event
        }
    });

    $(".button-login").click(function (){
        let data = {"username": $("#input-username").val(), "password": $("#input-password").val()};
        let btn = $(this);
        btn.addSpinner();
        $.ajax({
            url: "admin/login",
            method: "POST",
            data: data,
            success: (response) => {
                console.log(response);
                if (response.code === 0) {
                    window.location.href = response.data;
                } else {
                    let alert = $(".login-alert");
                    alert.text(response.message);
                    alert.show();
                }
            },
            error: () => {
                let alert = $(".login-alert");
                alert.text([[#{error_server}]]);
                alert.show();
            },
            complete: () => {
                btn.removeSpinner();
            }
        });
    });
</script>
</html>