<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="admin/header::general-libraries-and-styles(~{::title}, ~{::link}, ~{::head/script})">
    <script th:replace="admin/header::CKEditor"></script>
    <title>coupling-test</title>
</head>
<body>
<div th:replace="admin/sidebar::sidebar-fragment"></div>
<div class="main">
    <div class="content">
        <div id="editor">This is some sample content</div>
    </div>
</div>

<script>
    class UploadAdapter {
        constructor(loader) {
            //CKEditor 5 instance
            this.loader = loader;
            console.log(loader);
        }

        upload() {
            return this.loader.file.then(file => {
                return new Promise((resolve, reject) => {
                    const data = new FormData();
                    data.append("file", file);
                    $.ajax({
                        url: "/admin/ckeditor/upload",
                        method: "post",
                        processData: false,
                        contentType: false,
                        data: data,
                        success: (res) => {
                            if (res.code === 200) {
                                resolve({default: res.data.url});
                            } else {
                                showErrorAlert("error");
                                reject();
                            }
                        },
                        error: () => {
                            showServerErrorSwal();
                            reject();
                        },
                    });
                });
            })
        }

        abort() {

        }
    }

    function customUploadAdapter(editor) {
        editor.plugins.get("FileRepository").createUploadAdapter = (loader) => new UploadAdapter(loader);
    }

    ClassicEditor.create(document.querySelector("#editor"), {
        extraPlugins: [customUploadAdapter]
    }).then(editor => console.log(editor))
        .catch(error => console.log(error));
</script>
</body>
</html>